@use '../../foundation/spaces' as spaces;
@use '../../foundation/colors' as colors;
@use '../../foundation/utils' as utils;
@use '../../foundation/thypography' as thypography;
@use '../../foundation/sizes' as sizes;
@use '../../foundation/motion' as motion;
@use '../../foundation/borders' as borders;
@use '../icon' as icon;
@use 'mixins' as *;

.ch-menu {
  // 1. item

  &-item {
    @include spaces.inset(squish, m);

    display: block;
    width: 100%;
    position: relative;
    text-align: left;

    cursor: pointer;

    &,
    &:focus:hover,
    &:focus,
    &:hover,
    &:active {
      color: colors.get-color(text, 1);
    }

    // 1.1. Focus interaction

    &:focus:hover,
    &:hover,
    &:focus {
      background: colors.get-color(neutral, 2);
    }

    // 1.2. Icon variation

    &#{&}--icon {
      $size: utils.calc-box-height(
        $font-size: thypography.get-font-size(2),
        $padding-top: spaces.get-space(s),
        $padding-bottom: spaces.get-space(s)
      );

      @include spaces.paddingless(true);

      position: relative;

      width: $size;
      min-width: $size;
      min-height: $size;

      > * {
        display: none;
      }

      > .ch-icon:first-child,
      > .ch-avatar,
      > .ch-toggle-icon {
        position: absolute;
        display: block;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
    }

    // 1.3. Label

    &-label {
      display: block;
    }

    // 1.4. Has icon

    &.has-leadingIcon {
      padding-left: sizes.get-size(1) !important;

      > .ch-icon:first-child {
        left: calc((#{sizes.get-size(1)}) / 2);
      }
    }

    &.has-trailingIcon {
      padding-right: sizes.get-size(1) !important;

      > .ch-icon:first-child {
        right: calc((#{sizes.get-size(1)}) / 2);
      }
    }

    // 1.5. Active state

    &.is-active {
      font-weight: thypography.get-font-weight(bold);
    }
  }

  // 2. Active item bar

  > .ch-menu-item.is-active:before,
  > .ch-menu-submenu > .ch-menu-item.is-active:before {
    @include motion.transition(opacity);
    @include borders.border-radius(circle);

    display: block;
    position: absolute;
    top: 50%;
    left: spaces.get-space(xxs);
    width: spaces.get-space(xxs);
    height: icon.get-icon-size(m);
    transform: translate(0, -50%);

    content: '';
    background: colors.get-color(brand);
    opacity: 1;
  }

  // 3. Submenu

  &-submenu {

    // 3.1. Menu

    > .ch-menu {
      display: none;

      // 3.1.1. Item

      .ch-menu-item {
        padding-left: sizes.get-size(1);
      }
    }

    // 3.2. Arrow

    > .ch-menu-item > .ch-menu-item-arrow {
      @include motion.transition(
        transform,
        motion.$transition-duration-fast
      );

      transform: translate(50%, -50%);
    }

    // 3.3. Open state

    &.is-open {

      // 3.3.1. Menu

      > .ch-menu {
        display: block;

        animation:
          --ch-fade-in
          #{motion.$transition-duration-normal}
          #{motion.$transition-timing-function};
      }

      @keyframes --ch-fade-in {
        0% {
          opacity: 0;
        }

        100% {
          opacity: 1;
        }
      }

      // 3.3.2. Item

      > .ch-menu-item {
        opacity: 1;

        // 3.3.2.1. Sidebar

        &.is-active {
          font-weight: thypography.get-font-weight(normal);

          &:before {
            opacity: 0;
          }
        }

        // 3.3.2.2. Arrow

        > .ch-menu-item-arrow {
          transform: translate(50%, -50%) rotate(90deg);
        }
      }
    }
  }

  // 4. Group

  &-group {
    > .ch-title {
      @include spaces.inset(squish, m);
      @include thypography.caption;

      text-transform: uppercase;
    }

    > .ch-menu > .ch-menu-item {
      padding-left: spaces.get-space(xl);
    }
  }

  // 5. Horizontal variation

  &--horizontal {
    @include horizontal;
  }
}
